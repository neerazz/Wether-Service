<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Home Page</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
          crossorigin="anonymous">
</head>

<body>


<nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <h1>Weather</h1>
</nav>

<div class="container-fluid">

    <div class="container p-2">

        <form class="form-inline">
            <div class="form-group">
                <label>Enter Zip Code:</label>
                <input type="text" id="zipcode" class="form-control mx-sm-3">
                <button type="button" id="hourlyButton" class="btn btn-outline-primary p-2 m-2">Get Hourly Wether</button>
                <button type="button" id="lowestButton" class="btn btn-outline-secondary p-2 m-2">Get Lowest Wether</button>
            </div>
        </form>

        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="todayRadioButton" value="0">
            <label class="form-check-label">Today</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="tommarowRadioButton" value="1" checked>
            <label class="form-check-label">Tomorrow</label>
        </div>

    </div>

    <p class="font-weight-bolder font-italic">Weather data:</p>
    <div id="wetherdata"></div>

    <table class="table">
        <thead class="thead-light">
        <tr>
            <th scope="col">API Request URL:</th>
            <th scope="col">
                <div id="requestURL"></div>
            </th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th scope="row">Response:</th>
            <td>Mark</td>
        </tr>
        </tbody>
    </table>

</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>

<script>

    var apiURL = "/api/";

    $(document).ready(function () {

        $('#zipcode').keyup(function () {
            zipCodeChanged();
        });

        $("input[type='radio']").change(function () {
            radioBokChanged();
        });

        $("#hourlyButton").click(function () {
            loadHourlyURL();
        });

        $("#lowestButton").click(function () {
            loadLowestURL();
        });

    });

    function loadLowestURL() {
        var finalURL = apiURL + radioBokChanged() + "/lowest";
        $("#requestURL").text(finalURL);

        $.getJSON(finalURL, function (data) {
            buildPage(data);
            $("#responseURL").text(finalURL);
        });

    }

    function loadHourlyURL() {
        var finalURL = apiURL + radioBokChanged();
        $("#requestURL").text(finalURL);

        $.getJSON(finalURL, function (data) {
            buildPage(data);
            $("#responseURL").text(finalURL);
        });

    }

    function buildPage(dump) {

        var weatherTag = '<div class="card-group">';
        dump[0].hourlydate.forEach(function (e) {
            weatherTag += buildCard(e);
        })

        document.getElementById('wetherdata').innerHTML = weatherTag + '</div>';
    }

    function radioBokChanged() {
        return zipCodeChanged($("input[name='inlineRadioOptions']:checked").val());
    }

    function zipCodeChanged(requestURLString) {
        return requestURLString + "/" + $('#zipcode').val();;
    }

    function buildCard(input) {
        var date = new Date(input.timestamp_local);
        var output = '<div class="card border-dark mb-3" style="max-width: 10 rem;">';
        output += '<div class="card-body">';
        output += '<h5 class="card-title">' + input.temp + " C" + '</h5>';
        output += '<h5 class="card-text">' + date.getHours() + ":00 hrs" + '</h5>';
        output += '<h6 class="card-subtitle mb-2 text-muted">' + input.wetherdescription + '</h6>';
        output += '</div></div>';
        return output
    }

</script>

</body>
</html>